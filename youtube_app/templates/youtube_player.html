{% extends "base.html" %}

{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/bootstrap/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'fontawesome/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/grid.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>
    <title>Looper</title>
</head>

{% block content %}
<section id="main-body" class="main-body">
    <section class="player-container-index ">
        <section class="index-searcharea">
            <form action="{% url 'youtube_search' %}" method="get">
                <input name=yt_search id="index-searchbar" class="index-searchbar" type="search"
                       placeholder="Search ...">
                <button class="index-searchbar-btn" type="submit"><i class="fas fa-search"></i></button>
            </form>
        </section>


        <section class="videoplayer-index">
            <section class="main-video-index">
        <div class="player" id="player">
                <var> song_length = {{length}} </var>
                <script>
                    tag = document.createElement('script');

                    tag.src = "https://www.youtube.com/iframe_api";
                    firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    function onYouTubeIframeAPIReady() {
                        player = new YT.Player('player', {
                        height: '360',
                        width: '640',
                        playerVars: {'autoplay': 0, 'loop': 1},
                        events: {
                            'onReady': onPlayerReady,
                            'onStateChange': onPlayerStateChange
                            },
                        });
                    }

                    function onPlayerReady(event) {
                        event.target.loadVideoById( {
                                                      'videoId': '{{ video_id }}',
                                                      'startSeconds': '{{ start_video }}',
                                                      'endSeconds': '{{ stop_video }}',
                                                      'suggestedQuality': 'small',
                                                      });
                    }

                    function onPlayerStateChange(event) {
                        if (event.data == YT.PlayerState.ENDED) {
                            event.target.loadVideoById({
                                                        'videoId': '{{video_id}}',
                                                        'startSeconds': '{{ start_video }}',
                                                        'endSeconds': '{{ stop_video }}',
                                                        'suggestedQuality': 'small',
                                                        });
                        }
                    }
                </script>
        </div>
            </section>
        </section>
    </section>
<!--    <p>ID: {{ video_id }} - Length: {{ length }} </p>-->
<!--    <p>Start: {{ start_video }} - Stop: {{ stop_video }} </p>-->
    <section class="looper">
        <span id="lopper-timer">00:00</span>
        <div class="middle">

            <div class="multi-range-slider">

                <input type="range" id="input-left" min="0" max="100" value="25">
                <input type="range" id="input-right" min="0" max="100" value="75">

                <div class="slider">
                    <div class="track"></div>
                    <div class="range"></div>
                    <div class="thumb left"></div>
                    <div class="thumb right"></div>
                </div>
            </div>
        </div>
    </section>
    <div class="d-flex justify-content-center">
        <button id="btn-looper-play" class="btn-looper-play "><i id="i-looper-play" class="fa fa-play "></i></button>
        <button id="btn-looper-pause" class="btn-looper-pause d-none"><i id="i-looper-pause"
                                                                         class="fa fa-pause d-none"></i></button>
    </div>
</section>


{% endblock %}
